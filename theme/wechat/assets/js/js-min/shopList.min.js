/*! mygrunt 2015-08-14 */
function s_hmtl(a){var b='<li><a href="javascript:void(0)" style="font-weight: bold;" data-name="dist" data-value="'+a+'" class="shop-search">全部'+cityData[101].child[a].name+"</a></li>";$.each(cityData[101].child[a].child,function(){b+='<li><a href="javascript:void(0)" data-name="street" data-value="'+this.id+'" class="shop-search">'+this.name+"</a></li>"}),$(".rest-select-list ul").html(b)}function getSearchData(a){var b={name:$("#search-area-input").val(),category:$("#category").val(),dist:$("#dist").val(),street:$("#street").val()},c=$(a).data("name");return("dist"==c||"street"==c)&&(b.dist="",b.street=""),b[c]=$(a).data("value"),$.each(b,function(a,c){c||delete b[a]}),b}$(function(){var a=document.documentElement.clientHeight/16,b=new iScroll("rest-menu-area"),c=new iScroll("rest-select-list"),d='<li><a href="javascript:void(0)" data-name="dist" data-value="" class="shop-search">全城</a></li>';$.each(cityData[101].child,function(){this.id==$("#dist_id").val()?(d+='<li><span data-id="'+this.id+'" class="selected">'+this.name+"</span></li>",s_hmtl(this.id)):d+='<li><span data-id="'+this.id+'">'+this.name+"</span></li>"}),$(".rest-list-position ul").html(d),$(".rest-select-btn").on("click",function(){var d=$(this).data("select");0==$(".rest-select-area").height()?$(".rest-select-area").height(a-5.9375+"rem"):$(".rest-list-"+d).hasClass("active")&&$(".rest-select-area").height(0),$(".rest-list-"+d).hasClass("active")||($(".rest-menu-list").removeClass("active"),$(".rest-list-"+d).addClass("active"));var e=$(".rest-list-"+d).height()/16,f=a-10,g=f>e?e:f;$(".rest-menu-area").height(g+"rem"),$(".rest-select-list").height(g+"rem"),setTimeout(function(){b.refresh()},100),$(".rest-list-"+d+" span").hasClass("selected")?($(".rest-select-list").addClass("display"),setTimeout(function(){c.refresh()},100)):$(".rest-select-list").removeClass("display")}),$(".rest-scroll").on("click","span",function(){var a=$(this).data("id");s_hmtl(a),$(this).hasClass("selected")||($(".rest-select-area span").removeClass("selected"),$(this).addClass("selected")),$(".rest-select-list").hasClass("display")||$(".rest-select-list").addClass("display"),setTimeout(function(){c.refresh()},100)}),$(".rest-select-area").on("touchmove",function(a){a.preventDefault()}),$(".rest-select-area").on("click",function(){$(this).height(0)}),$(".rest-scroll").on("click",function(a){a.stopPropagation()}),$(".rest-scroll").on("click",".shop-search",function(){var a=getSearchData(this);location.href="/wechat/shop?"+$.param(a)}),$("#rest-page").on("click",function(){if($(this).children().hasClass("loading"))return!1;$(this).children().html("努力加载中").addClass("loading");var a=$(this).data("value");a++,$(this).data("value",a);var b=getSearchData(this);b.format="json",$.ajax({type:"POST",url:"/wechat/shop",data:b,dataType:"json",success:function(a){"success"==a.status&&($.each(a.data,function(){var a="";a+='<a href="/wechat/shop/detail/'+this.id+'">',a+='<div class="rest-message"><div class="logo"><img src="'+this.image+'"></div>',a+='<div class="message"><div class="name"><h4>'+this.name+"</h4><em>"+this.distance+"</em></div>",a+='<div class="detail"><div class="rateit-group">',a+='<div class="rateit" data-rateit-backingfld="#evaluate_'+this.id+'" data-rateit-readonly="readonly"></div>',a+='<input type="hidden" id="evaluate_'+this.id+'" value="'+this.star+'"></div>',a+='<span class="avg">人均：<em>￥'+this.avgprice+"</em></span></div>",a+="<p>"+this.address+"</p></div></div></a>",$(".rest-list-main").append(a)}),a.pager.page==a.pager.pages?$("#rest-page").remove():$("#rest-page span").html("点击加载下一页").removeClass("loading"))}})})});