function dish_dis(a){"0"==a?($("#dish-num").css("display","none"),$(".dish-list").removeClass("display")):$("#dish-num").css("display","block"),$("#dish-num").html(a)}function dish_add(a,b,c,d){var e=!0;if($(".field_order_food_fid").each(function(){if(a==$(this).val()){e=!1;var b=$(this).parent().find(".field_order_food_number").val();return b++,$(this).parent().find(".the-dish-num").html(b),$(this).parent().find(".field_order_food_number").val(b),!1}}),e){var f="<li>";f+='<input name="field_order_food['+d+'][fid]" type="hidden" value="'+a+'" class="field_order_food_fid">',f+='<input name="field_order_food['+d+'][price]" type="hidden" value="'+b+'"class="field_order_food_price">',f+="<p>"+c+'</p><p class="price">￥'+b+"</p>",f+='<div class="dish-number"><span class="dish-number-sub">-</span><span class="the-dish-num">1</span>',f+='<input name="field_order_food['+d+'][number]" type="hidden" value="1" class="field_order_food_number">',f+='<span class="dish-number-add">+</span></div></li>',$(".dish-list ul").prepend(f),d++,$("input[name=dish-order]").val(d)}}function price_total(){var a=0;$(".field_order_food_price").each(function(){var b=$(this).val(),c=$(this).parent().find(".field_order_food_number").val();a+=parseInt(b)*parseInt(c)}),$(".total-price").html("￥"+a)}$(function(){var a=new iScroll("dish-list-scroll"),b=(new iScroll("scroll-order-menu"),new iScroll("scroll-order-list")),c=$("input[name=dish-num]").val()||0;dish_dis(c),$("#order-menu span").click(function(){if(!$(this).hasClass("selected")){var a=$(this).data("tid"),c=$(this).html();$("#order-menu span").removeClass("selected"),$(this).addClass("selected"),$("#order-class").html(c),a?($("#order-list li").addClass("hide"),$(".tid-"+a).removeClass("hide")):$("#order-list li").removeClass("hide"),setTimeout(function(){b.refresh()},100)}}),$(".choose-dish").on("click",function(){c++,dish_dis(c);var b=$(this).data("id"),d=$(this).data("price"),e=$(this).data("name"),f=$("input[name=dish-order]").val();dish_add(b,d,e,f),price_total(),setTimeout(function(){a.refresh()},100)}),$(".shop-cart").on("click",function(){c>0&&($(".dish-list").hasClass("display")?$(".dish-list").removeClass("display"):$(".dish-list").addClass("display"))}),$(".dish-list").on("click",".dish-number-sub",function(){var b=$(this).next().html();b--,c--,dish_dis(c),0==b?($(this).parents("li").remove(),setTimeout(function(){a.refresh()},100),price_total()):($(this).next().html(b),$(this).parent().find("input").val(b),price_total())}),$(".dish-list").on("click",".dish-number-add",function(){var a=$(this).prev().val();a++,c++,dish_dis(c),$(this).parent().find(".the-dish-num").html(a),$(this).prev().val(a),price_total()}),$("#send-dish").on("click",function(){if(0==c)alert("您还未点餐");else{var a=$("input[name=shop_id]").val(),b=$(this).data("from");$.ajax({type:"POST",url:"/wechat/order/create",data:$("#dish-list").serialize(),dataType:"json",success:function(c){return"success"!=c.status?(alert(c.msg),!1):void("book"==b?location.href="/wechat/book/order?shop_id="+a+"&order="+c.data.id:"takeout"==b&&(location.href="/wechat/takeout/order?shop_id="+a+"&order="+c.data.id))}})}})});